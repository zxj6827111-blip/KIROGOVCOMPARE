# 后台管理功能指南

**完成日期**: 2025-12-13  
**功能状态**: ✅ 已完成  
**版本**: 1.0

---

## 📋 功能概览

后台管理系统提供三个核心功能模块：

### 1. 📋 任务管理
- 查看所有对比任务列表
- 按状态筛选任务（待处理、处理中、已完成、失败）
- 点击任务查看详细信息
- 查看任务的对比参数和结果

### 2. 📊 年报汇总
- 查看所有已上传的年报
- 按地区、年份、状态、关键词筛选
- 支持分页查看
- 修改年报状态（可用、禁用、未分配）
- 删除年报

### 3. 🗺️ 地区管理
- 查看所有地区列表
- 支持 4 级分类：省份、地级市、县级市、街道乡镇
- 新增地区
- 编辑地区信息（名称、级别、父级、状态、排序）
- 删除地区

---

## 🚀 快速开始

### 访问后台管理

1. 打开前端应用：http://localhost:3001
2. 点击导航栏右上角的 **🔐 后台管理** 按钮
3. 进入后台管理界面

### 界面布局

```
┌─────────────────────────────────────────────────┐
│  🎛️ 后台管理                                     │
├──────────┬──────────────────────────────────────┤
│ 📋 任务  │                                      │
│ 📊 年报  │      主内容区域                      │
│ 🗺️ 地区  │                                      │
└──────────┴──────────────────────────────────────┘
```

左侧是导航菜单，点击切换不同功能模块。

---

## 📋 任务管理详解

### 功能特性

- **任务列表**：左侧显示所有任务，按创建时间排序
- **任务详情**：右侧显示选中任务的完整信息
- **状态指示**：
  - ⏳ 待处理 - 任务已创建，等待处理
  - ⚙️ 处理中 - 任务正在处理
  - ✅ 已完成 - 任务完成，可查看结果
  - ❌ 失败 - 任务处理失败

### 操作流程

1. **查看任务列表**
   - 左侧显示所有任务
   - 任务按创建时间倒序排列

2. **筛选任务**
   - 使用状态筛选器快速查找特定状态的任务
   - 支持：全部、待处理、处理中、已完成、失败

3. **查看任务详情**
   - 点击左侧任务项
   - 右侧显示详细信息：
     - 任务 ID
     - 状态
     - 创建/更新时间
     - 对比参数（地区、年份或 URL）
     - 错误信息（如有）

4. **查看对比结果**
   - 任务完成后，点击 **👁️ 查看对比结果** 按钮
   - 跳转到对比结果页面

---

## 📊 年报汇总详解

### 功能特性

- **统计卡片**：显示总年报数
- **筛选条件**：
  - 地区：按上传地区筛选
  - 年份：按年份筛选
  - 状态：按资产状态筛选
  - 关键词：按文件名搜索

- **年报列表**：
  - 文件名
  - 所属地区
  - 年份
  - 来源（上传/URL）
  - 状态（可修改）
  - 上传时间
  - 操作（删除）

### 操作流程

1. **查看年报列表**
   - 默认显示所有年报
   - 表格显示年报的基本信息

2. **筛选年报**
   - 选择地区：只显示该地区的年报
   - 输入年份：只显示该年份的年报
   - 选择状态：只显示该状态的年报
   - 输入关键词：搜索文件名

3. **修改年报状态**
   - 点击状态列的下拉框
   - 选择新状态：
     - ✅ 可用 - 年报可用于前端创建任务
     - ❌ 禁用 - 年报被禁用，不会出现在前端
     - ⚠️ 未分配 - 年报未分配到地区
   - 状态自动保存

4. **删除年报**
   - 点击 **🗑️ 删除** 按钮
   - 确认删除
   - 年报从列表中移除

### 关键规则

- **只有 usable 状态的年报才会出现在用户侧**
- 禁用年报后，前端创建任务时不会显示该年份
- 删除年报后，如果该城市没有其他 usable 年报，城市会从前端消失

---

## 🗺️ 地区管理详解

### 4 级分类体系

```
省份 (Province)
  ├─ 地级市 (City)
  │   ├─ 县级市 (District)
  │   │   └─ 街道乡镇 (Township)
```

### 功能特性

- **地区列表**：显示所有地区
- **新增地区**：创建新的地区
- **编辑地区**：修改地区信息
- **删除地区**：删除地区

### 操作流程

1. **查看地区列表**
   - 表格显示所有地区
   - 显示信息：ID、名称、级别、父级、状态、排序

2. **新增地区**
   - 点击 **➕ 新增地区** 按钮
   - 填写表单：
     - 地区 ID：唯一标识（如：beijing_city）
     - 地区名称：显示名称（如：北京市）
     - 级别：选择级别（省份/地级市/县级市/街道乡镇）
     - 父级 ID：如果是下级地区，选择父级（可选）
     - 状态：启用/禁用
     - 排序：显示顺序（数字越小越靠前）
   - 点击 **💾 保存**

3. **编辑地区**
   - 点击地区行的 **✏️ 编辑** 按钮
   - 修改信息
   - 点击 **💾 保存**
   - 注意：地区 ID 不可修改

4. **删除地区**
   - 点击地区行的 **🗑️ 删除** 按钮
   - 确认删除
   - 地区从列表中移除

### 地区 ID 命名规范

建议使用以下格式：

```
省份：{name}_prov
地级市：{name}_city
县级市：{name}_district
街道乡镇：{name}_township
```

示例：
- beijing_prov（北京市 - 省份）
- guangzhou_city（广州市 - 地级市）
- chengdu_district（成都市 - 县级市）
- hangzhou_township（杭州市 - 街道乡镇）

---

## 🔄 工作流程示例

### 场景 1：上传新城市的年报

1. **后台管理** → **🗺️ 地区管理**
2. 点击 **➕ 新增地区**
3. 填写地区信息（如：深圳市）
4. 点击 **💾 保存**
5. **📊 年报汇总** → 上传该城市的年报
6. 用户侧自动显示该城市

### 场景 2：禁用某份年报

1. **后台管理** → **📊 年报汇总**
2. 找到要禁用的年报
3. 点击状态下拉框，选择 **❌ 禁用**
4. 用户侧该年份自动消失

### 场景 3：查看任务详情

1. **后台管理** → **📋 任务管理**
2. 左侧选择任务
3. 右侧显示任务详情
4. 如果任务已完成，点击 **👁️ 查看对比结果**

---

## 📊 数据统计

### 任务管理统计

- 总任务数：所有任务的总数
- 已完成：状态为 completed 的任务数

### 年报汇总统计

- 总年报数：所有年报的总数
- 支持按地区、年份、状态筛选

---

## ⚙️ API 端点

### 地区管理 API

```
GET    /api/v1/admin/regions                    - 获取地区列表
POST   /api/v1/admin/regions                    - 创建地区
PUT    /api/v1/admin/regions/:regionId          - 编辑地区
DELETE /api/v1/admin/regions/:regionId          - 删除地区
```

### 年报汇总 API

```
GET    /api/v1/admin/reports                    - 获取年报列表
GET    /api/v1/admin/reports/summary            - 获取统计数据
POST   /api/v1/admin/assets/upload              - 上传年报
PUT    /api/v1/admin/reports/:assetId/assign    - 修改年报状态
DELETE /api/v1/admin/reports/:assetId           - 删除年报
```

### 任务管理 API

```
GET    /api/v1/tasks                            - 获取任务列表
GET    /api/v1/tasks/:taskId                    - 获取任务详情
```

---

## 🎨 界面特性

### 响应式设计

- 桌面版：左侧导航 + 右侧内容
- 平板版：导航栏 + 内容
- 手机版：全屏内容，导航可折叠

### 颜色方案

- 主色：紫色（#667eea）
- 成功：绿色（#48bb78）
- 警告：橙色（#ed8936）
- 错误：红色（#f56565）

### 交互反馈

- 按钮悬停效果
- 表格行悬停高亮
- 加载状态提示
- 操作成功/失败提示

---

## 🔐 权限说明

当前版本没有权限控制，所有用户都可以访问后台管理。

**建议**：在生产环境中添加身份验证和权限控制。

---

## 📝 常见问题

### Q: 如何快速找到某份年报？
A: 使用年报汇总页面的筛选功能，按地区、年份或关键词搜索。

### Q: 删除年报后能恢复吗？
A: 不能。删除是永久操作，请谨慎操作。

### Q: 修改地区后，已有的年报会受影响吗？
A: 不会。地区信息修改不会影响已有的年报数据。

### Q: 为什么用户侧看不到某个城市？
A: 该城市可能没有 usable 状态的年报。检查年报汇总页面，确保该城市有 usable 年报。

---

## 🚀 下一步改进

- [ ] 添加用户身份验证
- [ ] 添加操作日志
- [ ] 添加批量操作功能
- [ ] 添加数据导出功能
- [ ] 添加图表统计
- [ ] 添加权限控制

---

**版本**: 1.0  
**最后更新**: 2025-12-13  
**状态**: ✅ 生产就绪

