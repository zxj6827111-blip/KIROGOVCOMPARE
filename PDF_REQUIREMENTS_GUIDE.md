# PDF 上传要求指南

**版本**：1.0  
**更新日期**：2025-12-15  
**状态**：生产环境

---

## 快速总结

系统支持**结构化 PDF**（有明确行列边界的表格）。

| 类型 | 支持 | 说明 |
|------|------|------|
| Word/LibreOffice 导出的 PDF | ✅ | 推荐 |
| 结构化表格 PDF | ✅ | 有明确边界 |
| 扫描件 | ❌ | 需要 OCR |
| 图片表格 | ❌ | 无法识别 |
| 文本排列表格 | ❌ | 无边框 |

---

## 什么是结构化 PDF

### ✅ 结构化 PDF 的特点

1. **表格有明确的行列边界**
   - 每个单元格都有清晰的边框
   - 行和列的分界线明确

2. **表格是文本而非图片**
   - 可以复制表格内容
   - 不是扫描件

3. **来源**
   - Word 导出的 PDF
   - LibreOffice 导出的 PDF
   - 其他办公软件导出的 PDF

### ❌ 非结构化 PDF 的特点

1. **扫描件**
   - 整个文档是图片
   - 无法复制文本
   - 需要 OCR 识别

2. **文本排列表格**
   - 表格是用空格或制表符排列的文本
   - 没有明确的边框
   - 看起来像表格但实际是文本

3. **图片表格**
   - 表格是嵌入的图片
   - 无法复制内容
   - 需要 OCR 识别

---

## 如何检查 PDF 是否符合要求

### 方法 1：尝试复制表格内容

1. 用 PDF 阅读器打开文件
2. 尝试选中表格内容
3. 复制到文本编辑器

**结果**：
- ✅ 能复制出有序的文本 → 符合要求
- ❌ 无法复制或复制出乱码 → 不符合要求

### 方法 2：检查文件属性

1. 用 PDF 阅读器打开文件
2. 查看文件属性或信息
3. 查看"生成工具"或"创建者"

**符合要求的工具**：
- ✅ Microsoft Word
- ✅ LibreOffice Writer
- ✅ Google Docs
- ✅ WPS Office

**不符合要求的工具**：
- ❌ 扫描仪
- ❌ 图片转 PDF 工具
- ❌ 某些特殊格式

---

## 如何转换 PDF

### 场景 1：原始文件是 Word 文档

**步骤**：
1. 在 Word 中打开文档
2. 点击"文件" → "另存为"
3. 选择"PDF"格式
4. 确保"保留格式"选项勾选
5. 保存

**注意**：
- 确保表格在 Word 中是真实的表格（不是图片）
- 不要使用"导出为图片"功能

### 场景 2：原始文件是 LibreOffice 文档

**步骤**：
1. 在 LibreOffice 中打开文档
2. 点击"文件" → "导出为 PDF"
3. 确保所有选项都是默认值
4. 导出

**注意**：
- LibreOffice 导出的 PDF 通常质量很好
- 推荐使用

### 场景 3：原始文件是扫描件或图片

**步骤**：
1. 获取原始的 Word/LibreOffice 文件
2. 按照场景 1 或 2 转换

**如果没有原始文件**：
- 需要使用 OCR 工具（暂不支持）
- 请联系系统管理员

### 场景 4：原始文件是 Google Docs

**步骤**：
1. 在 Google Docs 中打开文档
2. 点击"文件" → "下载" → "PDF 文档"
3. 保存

**注意**：
- Google Docs 导出的 PDF 质量很好
- 推荐使用

---

## 测试 PDF

我们提供了 2 份测试 PDF，可以正常识别表格：

### hzq2023.pdf - 杭州市 2023 年报告

**特点**：
- 文件大小：286.6KB
- 表格数：6 张
- 识别成功率：100%
- 非空单元格：29 个

**下载**：
```bash
# 从 fixtures/sample_pdfs_v1/ 目录获取
cp fixtures/sample_pdfs_v1/hzq2023.pdf sample_pdfs_v1/
```

### hzq2024.pdf - 杭州市 2024 年报告

**特点**：
- 文件大小：234.5KB
- 表格数：6 张
- 识别成功率：100%
- 非空单元格：29 个

**下载**：
```bash
# 从 fixtures/sample_pdfs_v1/ 目录获取
cp fixtures/sample_pdfs_v1/hzq2024.pdf sample_pdfs_v1/
```

---

## 常见问题

### Q1：我的 PDF 无法识别表格，怎么办？

**A**：
1. 检查 PDF 是否是结构化的（按照上面的方法检查）
2. 如果是扫描件，需要转换为结构化 PDF
3. 如果无法转换，请联系系统管理员

### Q2：我的 PDF 是扫描件，怎么办？

**A**：
1. 获取原始的 Word/LibreOffice 文件
2. 按照转换指南重新导出为 PDF
3. 上传新的 PDF

**如果没有原始文件**：
- 系统暂不支持扫描件
- 请联系系统管理员了解 OCR 支持的时间表

### Q3：我的 PDF 是用其他工具生成的，怎么办？

**A**：
1. 尝试在 Word 或 LibreOffice 中打开
2. 重新导出为 PDF
3. 上传新的 PDF

### Q4：识别结果不准确，怎么办？

**A**：
1. 检查 PDF 中的表格是否有明确的边界
2. 尝试调整表格格式（增加边框、调整列宽等）
3. 重新导出为 PDF
4. 上传新的 PDF

### Q5：什么时候支持扫描件？

**A**：
- 系统正在评估 OCR 支持
- 预计在 1-2 个月内添加
- 请关注系统更新

---

## 最佳实践

### 1. 准备 PDF 时

- ✅ 使用 Word 或 LibreOffice
- ✅ 确保表格是真实的表格（不是图片）
- ✅ 确保表格有明确的边界
- ✅ 测试导出的 PDF（尝试复制表格内容）

### 2. 上传 PDF 时

- ✅ 确保文件名清晰（包含年份和地区）
- ✅ 确保文件大小合理（< 10MB）
- ✅ 一次上传一个文件

### 3. 检查结果时

- ✅ 查看识别的表格数量
- ✅ 查看非空单元格数量
- ✅ 查看置信度分数
- ✅ 如果结果不理想，检查 PDF 质量

---

## 技术细节

### 支持的表格格式

**pdfplumber 支持**：
- 有明确行列线的表格
- 网格表格
- 有边框的表格

**pdfplumber 不支持**：
- 扫描件（图片）
- 文本排列表格（无边框）
- 特殊格式表格

### 识别参数

系统使用以下参数识别表格：

```python
table_settings = {
    'vertical_strategy': 'lines',
    'horizontal_strategy': 'lines',
    'snap_tolerance': 3,
    'join_tolerance': 3,
}
```

### 性能指标

- 平均处理时间：635ms
- 最快处理时间：469ms
- 最慢处理时间：1001ms

---

## 反馈和支持

### 如何报告问题

1. 记录 PDF 文件名
2. 记录识别结果（表格数、非空单元格数等）
3. 描述问题（无法识别、识别不准确等）
4. 联系系统管理员

### 如何请求功能

1. 描述需求（例如：支持扫描件）
2. 提供示例 PDF
3. 联系系统管理员

---

## 相关资源

- `REAL_PDF_TEST_RESULTS.md` - 详细测试结果
- `TABLE_EXTRACTION_SOLUTION_ANALYSIS.md` - 技术分析
- `P0_FINAL_VERIFICATION.md` - 最终验证报告
- `fixtures/sample_pdfs_v1/` - 测试 PDF 文件

---

**最后更新**：2025-12-15  
**版本**：1.0  
**状态**：生产环境

