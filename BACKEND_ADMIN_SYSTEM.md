# 后端管理系统使用指南

**更新日期**: 2025-12-13  
**版本**: 2.0  
**架构**: 后端独立管理界面

---

## 📌 系统架构

### 前端（用户端）
- **地址**: http://localhost:3001
- **功能**: 
  - 选择城市和年份
  - 创建对比任务
  - 查看对比结果

### 后端（管理端）
- **地址**: http://localhost:3000/admin
- **功能**:
  - 地区配置管理
  - 年报上传维护
  - 历史比对记录查看

---

## 🚀 快速开始

### 启动系统

```bash
# 终端 1：启动后端（包含管理界面）
node dist/index-mock.js

# 终端 2：启动前端
cd frontend
PORT=3001 npm start
```

### 访问应用

- **用户端**：http://localhost:3001
- **后台管理**：http://localhost:3000/admin

---

## 📋 后台管理功能

### 1️⃣ 地区管理 (🗺️)

**功能**：配置和管理城市/地区

#### 新增地区

1. 点击 **➕ 新增地区** 按钮
2. 填写表单：
   - **地区 ID**：唯一标识（如：beijing_city）
   - **地区名称**：显示名称（如：北京市）
   - **级别**：选择级别
     - 省份 (Province)
     - 地级市 (City)
     - 县级市 (District)
     - 街道乡镇 (Township)
   - **父级 ID**：如果是下级地区，填写父级 ID（可选）
3. 点击 **💾 保存**

#### 查看地区列表

- 显示所有已配置的地区
- 显示地区 ID、名称、级别、父级信息

#### 删除地区

1. 在地区列表中找到要删除的地区
2. 点击 **🗑️ 删除** 按钮
3. 确认删除

---

### 2️⃣ 年报汇总 (📊)

**功能**：上传和维护年报

#### 上传年报

1. 点击 **⬆️ 上传年报** 按钮
2. 填写表单：
   - **地区**：选择年报所属的地区
   - **年份**：输入年份（如：2024）
   - **选择文件**：选择 PDF 文件
3. 点击 **💾 上传**

**效果**：
- 年报立刻出现在列表中
- 自动标记为 usable 状态
- 用户侧立刻显示该年份

#### 查看年报列表

- 显示所有已上传的年报
- 显示文件名、地区、年份、状态、上传时间

#### 删除年报

1. 在年报列表中找到要删除的年报
2. 点击 **🗑️ 删除** 按钮
3. 确认删除

---

### 3️⃣ 比对记录 (📋)

**功能**：查看历史比对任务

#### 统计信息

- **总比对数**：所有比对任务的总数
- **已完成**：完成的比对任务数

#### 比对记录列表

显示所有比对任务的信息：
- 任务 ID
- 地区
- 年份 A
- 年份 B
- 状态
- 创建时间

---

## 💡 常见操作流程

### 场景 1：添加新城市并上传年报

```
步骤：
1. 后台 → 地区管理 → 新增地区
2. 填写：
   - 地区 ID: shenzhen_city
   - 名称: 深圳市
   - 级别: 地级市
   - 父级: guangdong_prov
3. 保存
4. 后台 → 年报汇总 → 上传年报
5. 选择地区: 深圳市
6. 输入年份: 2024
7. 选择文件: 深圳市2024年报.pdf
8. 上传
9. 用户侧自动显示深圳市
```

### 场景 2：查看比对记录

```
步骤：
1. 后台 → 比对记录
2. 查看统计信息（总比对数、已完成数）
3. 查看比对记录列表
4. 了解用户的比对历史
```

### 场景 3：维护年报

```
步骤：
1. 后台 → 年报汇总
2. 查看所有已上传的年报
3. 如需删除过期年报，点击删除按钮
4. 如需上传新年报，点击上传按钮
```

---

## 🔄 数据流向

### 上传年报后的流程

```
1. 后台上传年报
   ↓
2. 后端保存年报（标记为 usable）
   ↓
3. 用户侧 API 自动返回该年份
   ↓
4. 用户侧创建任务页面自动显示该年份
```

### 用户创建任务后的流程

```
1. 用户选择城市和年份
   ↓
2. 用户点击创建任务
   ↓
3. 后端创建任务记录
   ↓
4. 后台可以查看该任务记录
```

---

## 📊 API 端点

### 地区管理 API

```
GET    /api/v1/admin/regions                    - 获取地区列表
POST   /api/v1/admin/regions                    - 创建地区
PUT    /api/v1/admin/regions/:regionId          - 编辑地区
DELETE /api/v1/admin/regions/:regionId          - 删除地区
```

### 年报汇总 API

```
GET    /api/v1/admin/reports                    - 获取年报列表
GET    /api/v1/admin/reports/summary            - 获取统计数据
POST   /api/v1/admin/assets/upload              - 上传年报
PUT    /api/v1/admin/reports/:assetId/assign    - 修改年报状态
DELETE /api/v1/admin/reports/:assetId           - 删除年报
```

### 比对记录 API

```
GET    /api/v1/tasks                            - 获取任务列表
GET    /api/v1/tasks/:taskId                    - 获取任务详情
```

---

## 🎨 界面说明

### 侧边栏菜单

```
🎛️ 后台管理
├── 🗺️ 地区管理
├── 📊 年报汇总
└── 📋 比对记录
```

点击菜单项切换功能模块。

### 按钮说明

- **➕ 新增地区** - 添加新的地区
- **⬆️ 上传年报** - 上传年报文件
- **🗑️ 删除** - 删除地区或年报
- **💾 保存** - 保存表单数据
- **❌ 取消** - 取消操作

---

## 🆘 常见问题

### Q: 后台管理和用户端的区别是什么？
A: 
- **用户端**：创建任务、查看结果
- **后台管理**：配置地区、上传年报、查看记录

### Q: 上传年报后多久会出现在用户侧？
A: 立刻出现，无需刷新页面

### Q: 可以上传非 PDF 文件吗？
A: 当前只支持 PDF 文件

### Q: 删除年报后能恢复吗？
A: 不能，删除是永久操作

### Q: 为什么用户侧看不到某个城市？
A: 该城市可能没有 usable 状态的年报。检查年报汇总页面

### Q: 如何快速找到某份年报？
A: 在年报列表中查看，或通过地区和年份信息定位

### Q: 地区 ID 有什么规范吗？
A: 建议使用格式：{name}_{level}，如：beijing_city、guangzhou_district

---

## 📱 浏览器兼容性

后台管理支持以下浏览器：
- Chrome（推荐）
- Firefox
- Safari
- Edge

---

## 🔐 安全建议

生产环境建议添加：

1. **身份验证** - 添加登录功能
2. **权限控制** - 限制操作权限
3. **操作日志** - 记录所有操作
4. **数据备份** - 定期备份数据
5. **速率限制** - 防止滥用

---

## 📞 技术支持

如有问题，请检查：

1. 后端是否正常运行（http://localhost:3000）
2. 前端是否正常运行（http://localhost:3001）
3. 浏览器控制台是否有错误信息
4. 网络连接是否正常

---

## 📝 文件结构

```
src/
├── public/
│   ├── index.html          - 用户端主页
│   └── admin.html          - 后台管理页面 ⭐
├── routes/
│   ├── admin.ts            - 后台管理 API
│   ├── catalog.ts          - 用户侧 API
│   └── ...
└── index-mock.ts           - 后端服务器
```

---

**版本**: 2.0  
**最后更新**: 2025-12-13  
**状态**: ✅ 生产就绪

