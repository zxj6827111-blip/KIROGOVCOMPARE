# 后台管理使用指南

**更新日期**: 2025-12-13  
**版本**: 1.0

---

## 📌 重要说明

**后台管理是前端应用的一部分**，不是独立的后端界面。

- 访问地址：http://localhost:3001（与用户端相同）
- 点击 **🔐 后台管理** 按钮进入
- 所有操作都是通过前端调用后端 API 完成的

---

## 🚀 快速开始

### 第一步：启动系统

```bash
# 终端 1：启动后端
node dist/index-mock.js

# 终端 2：启动前端
cd frontend
PORT=3001 npm start
```

### 第二步：进入后台管理

1. 打开浏览器：http://localhost:3001
2. 点击右上角 **🔐 后台管理** 按钮
3. 进入后台管理界面

---

## 📋 三大功能模块

### 1️⃣ 任务管理 (📋)

**功能**：查看和管理所有对比任务

**操作步骤**：
1. 点击左侧菜单 **📋 任务管理**
2. 左侧显示任务列表
3. 点击任务查看详情
4. 右侧显示任务的完整信息

**可查看的信息**：
- 任务 ID
- 任务状态（待处理、处理中、已完成、失败）
- 创建时间
- 对比参数（地区、年份或 URL）
- 错误信息（如有）

**筛选功能**：
- 按状态筛选任务

---

### 2️⃣ 年报汇总 (📊)

**功能**：管理所有上传的年报

#### 查看年报列表

1. 点击左侧菜单 **📊 年报汇总**
2. 显示所有年报的列表
3. 表格显示：文件名、地区、年份、来源、状态、上传时间

#### 筛选年报

使用筛选条件快速查找年报：

```
地区：选择特定地区
年份：输入年份（如 2024）
状态：选择状态（可用/禁用/未分配）
关键词：输入文件名关键词
```

#### 上传年报 ⭐ 新功能

1. 点击 **⬆️ 上传年报** 按钮
2. 填写表单：
   - **地区**：选择年报所属的地区
   - **年份**：输入年份（如 2024）
   - **选择文件**：选择 PDF 文件
3. 点击 **💾 上传** 按钮
4. 上传成功后，年报立刻出现在列表中

**重要**：
- 上传后自动标记为 **usable** 状态
- 用户侧会立刻看到该年份
- 如果是新城市，城市也会立刻出现在用户侧

#### 修改年报状态

1. 找到要修改的年报
2. 点击状态列的下拉框
3. 选择新状态：
   - **✅ 可用** - 出现在用户侧
   - **❌ 禁用** - 不出现在用户侧
   - **⚠️ 未分配** - 未分配到地区
4. 状态自动保存

**效果**：
- 修改为"禁用"后，用户侧该年份立刻消失
- 修改为"可用"后，用户侧该年份立刻出现

#### 删除年报

1. 找到要删除的年报
2. 点击 **🗑️ 删除** 按钮
3. 确认删除
4. 年报从列表中移除

**警告**：删除是永久操作，无法恢复！

---

### 3️⃣ 地区管理 (🗺️)

**功能**：管理城市和地区

#### 查看地区列表

1. 点击左侧菜单 **🗺️ 地区管理**
2. 显示所有地区的列表
3. 表格显示：地区 ID、名称、级别、父级、状态、排序

#### 新增地区

1. 点击 **➕ 新增地区** 按钮
2. 填写表单：
   - **地区 ID**：唯一标识（如：shenzhen_city）
   - **地区名称**：显示名称（如：深圳市）
   - **级别**：选择级别
     - 省份 (Province)
     - 地级市 (City)
     - 县级市 (District)
     - 街道乡镇 (Township)
   - **父级 ID**：如果是下级地区，选择父级（可选）
   - **状态**：启用/禁用
   - **排序**：显示顺序（数字越小越靠前）
3. 点击 **💾 保存**

#### 编辑地区

1. 找到要编辑的地区
2. 点击 **✏️ 编辑** 按钮
3. 修改信息
4. 点击 **💾 保存**

**注意**：地区 ID 不可修改

#### 删除地区

1. 找到要删除的地区
2. 点击 **🗑️ 删除** 按钮
3. 确认删除
4. 地区从列表中移除

---

## 💡 常见操作流程

### 场景 1：添加新城市并上传年报

```
步骤：
1. 后台 → 地区管理 → 新增地区
2. 填写：
   - 地区 ID: shenzhen_city
   - 名称: 深圳市
   - 级别: 地级市
   - 父级: guangdong_prov
3. 保存
4. 后台 → 年报汇总 → 上传年报
5. 选择地区: 深圳市
6. 输入年份: 2024
7. 选择文件: 深圳市2024年报.pdf
8. 上传
9. 用户侧自动显示深圳市
```

### 场景 2：禁用某份年报

```
步骤：
1. 后台 → 年报汇总
2. 找到要禁用的年报
3. 点击状态下拉框
4. 选择"禁用"
5. 用户侧该年份自动消失
```

### 场景 3：查看任务详情

```
步骤：
1. 后台 → 任务管理
2. 左侧选择任务
3. 右侧显示详情
4. 如果任务已完成，点击"查看对比结果"
```

---

## 🔄 数据流向

### 上传年报后的流程

```
1. 前端上传年报
   ↓
2. 后端保存年报（标记为 usable）
   ↓
3. 用户侧 API 自动返回该年份
   ↓
4. 用户侧创建任务页面自动显示该年份
```

### 禁用年报后的流程

```
1. 后台修改年报状态为"禁用"
   ↓
2. 后端更新年报状态
   ↓
3. 用户侧 API 不再返回该年份
   ↓
4. 用户侧创建任务页面自动隐藏该年份
```

---

## 📊 统计信息

### 任务管理统计

- **总任务数**：所有任务的总数
- **已完成**：完成的任务数

### 年报汇总统计

- **总年报数**：所有年报的总数

---

## 🎨 界面说明

### 侧边栏菜单

```
🎛️ 后台管理
├── 📋 任务管理
├── 📊 年报汇总
└── 🗺️ 地区管理
```

点击菜单项切换功能模块。

### 返回用户端

点击导航栏的 **👈 返回用户端** 按钮返回用户端。

---

## ⚙️ 技术细节

### API 端点

**地区管理**：
```
GET    /api/v1/admin/regions                    - 获取地区列表
POST   /api/v1/admin/regions                    - 创建地区
PUT    /api/v1/admin/regions/:regionId          - 编辑地区
DELETE /api/v1/admin/regions/:regionId          - 删除地区
```

**年报汇总**：
```
GET    /api/v1/admin/reports                    - 获取年报列表
GET    /api/v1/admin/reports/summary            - 获取统计数据
POST   /api/v1/admin/assets/upload              - 上传年报
PUT    /api/v1/admin/reports/:assetId/assign    - 修改年报状态
DELETE /api/v1/admin/reports/:assetId           - 删除年报
```

**任务管理**：
```
GET    /api/v1/tasks                            - 获取任务列表
GET    /api/v1/tasks/:taskId                    - 获取任务详情
```

---

## 🆘 常见问题

### Q: 后台管理和用户端的区别是什么？
A: 
- **用户端**：创建任务、查看结果
- **后台管理**：管理地区、年报、任务

### Q: 上传年报后多久会出现在用户侧？
A: 立刻出现，无需刷新页面

### Q: 禁用年报后用户侧会立刻消失吗？
A: 是的，立刻消失。用户需要刷新页面才能看到变化

### Q: 可以上传非 PDF 文件吗？
A: 当前只支持 PDF 文件

### Q: 删除年报后能恢复吗？
A: 不能，删除是永久操作

### Q: 为什么用户侧看不到某个城市？
A: 该城市可能没有 usable 状态的年报。检查年报汇总页面

### Q: 如何快速找到某份年报？
A: 使用筛选功能，按地区、年份或关键词搜索

### Q: 地区 ID 有什么规范吗？
A: 建议使用格式：{name}_{level}，如：beijing_city、guangzhou_district

---

## 📱 移动端使用

后台管理支持移动端访问：
- 侧边栏自动折叠
- 表格自动适配
- 触摸友好的按钮

---

## 🔐 权限说明

当前版本没有权限控制，所有用户都可以访问后台管理。

**建议**：生产环境中添加身份验证和权限控制。

---

## 📞 技术支持

如有问题，请检查：

1. 后端是否正常运行（http://localhost:3000）
2. 前端是否正常运行（http://localhost:3001）
3. 浏览器控制台是否有错误信息
4. 网络连接是否正常

---

**版本**: 1.0  
**最后更新**: 2025-12-13  
**状态**: ✅ 可用

