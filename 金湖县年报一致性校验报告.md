# 金湖县年报一致性校验使用说明

## 📊 校验结果概览

您的金湖县 2023 年报告已完成一致性校验：

- **校验状态**: ✅ 成功完成
- **发现问题**: 1 个失败项 (FAIL)
- **待人工复核**: 22 个项目（已通过自动校验，建议人工确认）

## 🔍 发现的问题

### 问题 #1：表四数据不一致（行政诉讼-未经复议）

**问题描述**:
```
表四：结果维持+结果纠正+其他结果+尚未审结=总计（行政诉讼-未经复议）
```

**校验公式**: `maintain + correct + other + unfinished = total`

**数据**:
- 结果维持 (maintain): 2
- 结果纠正 (correct): 0
- 其他结果 (other): 1
- 尚未审结 (unfinished): 0
- **计算总计**: 2 + 0 + 1 + 0 = **3**
- **表中总计**: **0**
- **差值**: 3

**结论**: 表四中"行政诉讼-未经复议"的总计栏填写有误，应为 3 而不是 0。

## 💡 如何使用校验功能

### 1. 查看校验结果

```bash
# 查看基本结果（只显示 FAIL 和 UNCERTAIN 的问题）
curl http://localhost:8787/api/reports/33/checks

# 查看所有项（包括已忽略的）
curl "http://localhost:8787/api/reports/33/checks?include_dismissed=1"
```

### 2. 人工复核操作

#### 确认问题（标记为 confirmed）
```bash
curl -Method PATCH http://localhost:8787/api/reports/33/checks/items/20 `
  -H "Content-Type: application/json" `
  -Body '{"human_status": "confirmed", "human_comment": "经核实，确实是录入错误"}'
```

#### 忽略问题（标记为 dismissed）
如果您认为某个问题实际上不是问题（例如，数据源本身就是这样的），可以标记为 dismissed：

```bash
curl -Method PATCH http://localhost:8787/api/reports/33/checks/items/20 `
  -H "Content-Type: application/json" `
  -Body '{"human_status": "dismissed", "human_comment": "原报告就是这样填的，非系统错误"}'
```

#### 恢复待复核状态
```bash
curl -Method PATCH http://localhost:8787/api/reports/33/checks/items/20 `
  -H "Content-Type: application/json" `
  -Body '{"human_status": "pending"}'
```

### 3. 重新运行校验

如果修改了报告数据后想重新校验：

```bash
curl -Method POST http://localhost:8787/api/reports/33/checks/run
```

## 📋 校验规则说明

系统自动检查以下内容：

### 表三（政府信息公开申请办理情况）
1. **办理结果总计校验**: 各分项之和 = 办理结果总计
2. **恒等式校验**: 本年新收 + 上年结转 = 办理结果总计 + 结转下年度继续办理
3. **总计列校验**: 各列（自然人、法人等）之和 = 总计列

### 表四（行政复议和诉讼情况）
1. **求和校验**: 结果维持 + 结果纠正 + 其他结果 + 尚未审结 = 总计
   - 对行政复议、行政诉讼（未经复议）、行政诉讼（复议后起诉）分别校验

### 正文一致性
1. **文本与表格对照**: 从正文中提取的数字与表三、表四中的数字进行对照
   - 本年新收
   - 上年结转
   - 办理结果总计
   - 结转下年度继续办理
   - 行政复议

## 🎯 校验结果解释

- **PASS**: ✅ 数据一致，无问题
- **FAIL**: ❌ 数据不一致，需要修正
- **UNCERTAIN**: ⚠️ 无法确定（如：数据缺失、匹配多处等）
- **NOT_ASSESSABLE**: ⏸️ 无法评估（如：表格缺失）

## 🔄 自动触发机制

从现在开始，所有新上传并解析的报告都会**自动触发一致性校验**。您无需手动操作。

对于旧报告（如金湖县这份），需要手动触发一次：
```bash
curl -Method POST http://localhost:8787/api/reports/33/checks/run
```

## 📞 下一步建议

1. **修正问题**: 根据校验结果修正表四中的数据错误
2. **人工复核**: 对 22 个待复核项进行确认
3. **重新上传**: 修正后重新上传报告，系统会自动重新校验

---

*生成时间: 2025-12-25*
*报告ID: 33 (金湖县 2023 年)*
*校验引擎版本: v1*
